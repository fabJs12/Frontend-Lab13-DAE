# ğŸ“ Arquitectura y Flujo de la AplicaciÃ³n

## ğŸ—ï¸ Arquitectura General

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     FRONTEND (React)                         â”‚
â”‚                   http://localhost:3001                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚   NavBar     â”‚  â”‚    Home      â”‚  â”‚ Categories   â”‚       â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚       â”‚
â”‚  â”‚ - CategorÃ­as â”‚  â”‚ - Products   â”‚  â”‚ - All cats   â”‚       â”‚
â”‚  â”‚ - Cart Badge â”‚  â”‚ - Prefetch   â”‚  â”‚ - Prefetch   â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚        â”‚                   â”‚                  â”‚              â”‚
â”‚        â”‚                   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚        â”‚                          â”‚                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚    React Query (v5)                      â”‚               â”‚
â”‚  â”‚ - Query Client                           â”‚               â”‚
â”‚  â”‚ - Cache Management                       â”‚               â”‚
â”‚  â”‚ - Prefetch                               â”‚               â”‚
â”‚  â”‚ - Mutations (Optimistic Updates)         â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚             â”‚                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚  Custom Hooks (useQueries.js)            â”‚                â”‚
â”‚  â”‚                                          â”‚                â”‚
â”‚  â”‚  âœ“ useProducts()                         â”‚                â”‚
â”‚  â”‚  âœ“ useCategories()                       â”‚                â”‚
â”‚  â”‚  âœ“ useCart()                             â”‚                â”‚
â”‚  â”‚  âœ“ useAddToCart() [Optimistic]           â”‚                â”‚
â”‚  â”‚  âœ“ useUpdateCartItem()                   â”‚                â”‚
â”‚  â”‚  âœ“ useRemoveFromCart()                   â”‚                â”‚
â”‚  â”‚  âœ“ usePrefetchProductDetail()            â”‚                â”‚
â”‚  â”‚  âœ“ usePrefetchCategoryProducts()         â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚             â”‚                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚  API Client (axios)                 â”‚                    â”‚
â”‚  â”‚  Base: http://127.0.0.1:8000/api/   â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚             â”‚                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ HTTP Requests
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               BACKEND (Django)                                â”‚
â”‚           http://127.0.0.1:8000                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚   API Endpoints (REST)               â”‚                     â”‚
â”‚  â”‚                                      â”‚                     â”‚
â”‚  â”‚  GET    /api/categorias/             â”‚                     â”‚
â”‚  â”‚  GET    /api/categorias/{id}/        â”‚                     â”‚
â”‚  â”‚  GET    /api/categorias/{id}/        â”‚                     â”‚
â”‚  â”‚         productos/                   â”‚                     â”‚
â”‚  â”‚                                      â”‚                     â”‚
â”‚  â”‚  GET    /api/productos/              â”‚                     â”‚
â”‚  â”‚  GET    /api/productos/{id}/         â”‚                     â”‚
â”‚  â”‚                                      â”‚                     â”‚
â”‚  â”‚  GET    /api/carrito/                â”‚                     â”‚
â”‚  â”‚  POST   /api/carrito/agregar/        â”‚                     â”‚
â”‚  â”‚  PUT    /api/carrito/actualizar/{id}/â”‚                     â”‚
â”‚  â”‚  DELETE /api/carrito/eliminar/{id}/  â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                    â”‚                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚   ViewSets (REST Framework)         â”‚                       â”‚
â”‚  â”‚                                    â”‚                       â”‚
â”‚  â”‚  - CategoriaViewSet                â”‚                       â”‚
â”‚  â”‚  - ProductoViewSet                 â”‚                       â”‚
â”‚  â”‚  - CarritoViewSet                  â”‚                       â”‚
â”‚  â”‚    â”œâ”€â”€ list()                      â”‚                       â”‚
â”‚  â”‚    â”œâ”€â”€ agregar()                   â”‚                       â”‚
â”‚  â”‚    â”œâ”€â”€ actualizar()                â”‚                       â”‚
â”‚  â”‚    â””â”€â”€ eliminar()                  â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                    â”‚                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚   Serializers                       â”‚                       â”‚
â”‚  â”‚                                    â”‚                       â”‚
â”‚  â”‚  - CategoriaSerializer             â”‚                       â”‚
â”‚  â”‚  - ProductoSerializer              â”‚                       â”‚
â”‚  â”‚  - CarritoItemSerializer           â”‚                       â”‚
â”‚  â”‚    â”œâ”€â”€ Validaciones                â”‚                       â”‚
â”‚  â”‚    â””â”€â”€ Datos anidados              â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                    â”‚                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚   Modelos (Database)                    â”‚                   â”‚
â”‚  â”‚                                        â”‚                   â”‚
â”‚  â”‚  - Categoria                           â”‚                   â”‚
â”‚  â”‚    â”œâ”€â”€ id (PK)                         â”‚                   â”‚
â”‚  â”‚    â”œâ”€â”€ nombre                          â”‚                   â”‚
â”‚  â”‚    â””â”€â”€ descripcion                     â”‚                   â”‚
â”‚  â”‚                                        â”‚                   â”‚
â”‚  â”‚  - Producto                            â”‚                   â”‚
â”‚  â”‚    â”œâ”€â”€ id (PK)                         â”‚                   â”‚
â”‚  â”‚    â”œâ”€â”€ nombre                          â”‚                   â”‚
â”‚  â”‚    â”œâ”€â”€ precio                          â”‚                   â”‚
â”‚  â”‚    â”œâ”€â”€ stock                           â”‚                   â”‚
â”‚  â”‚    â”œâ”€â”€ imagen_url                      â”‚                   â”‚
â”‚  â”‚    â””â”€â”€ categoria_id (FK)               â”‚                   â”‚
â”‚  â”‚                                        â”‚                   â”‚
â”‚  â”‚  - CarritoItem                         â”‚                   â”‚
â”‚  â”‚    â”œâ”€â”€ id (PK)                         â”‚                   â”‚
â”‚  â”‚    â”œâ”€â”€ producto_id (FK)                â”‚                   â”‚
â”‚  â”‚    â””â”€â”€ cantidad                        â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                    â”‚                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚   Base de Datos (SQLite / PostgreSQL)   â”‚                   â”‚
â”‚  â”‚                                        â”‚                   â”‚
â”‚  â”‚  - categorias                          â”‚                   â”‚
â”‚  â”‚  - productos                           â”‚                   â”‚
â”‚  â”‚  - carrito_items                       â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Flujo de Funcionamiento - Agregar al Carrito (Optimistic Update)

```
Usuario hace clic en "AÃ±adir al Carrito"
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ React Component dispara mutaciÃ³n    â”‚
â”‚ (useAddToCart)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OPTIMISTIC UPDATE (Fase 1)          â”‚
â”‚ âœ“ UI se actualiza INMEDIATAMENTE   â”‚
â”‚ âœ“ CachÃ© se modifica sin esperar     â”‚
â”‚ âœ“ Usuario ve el resultado al instante
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ENVIAR REQUEST AL BACKEND            â”‚
â”‚ POST /api/carrito/agregar/           â”‚
â”‚ {"producto_id": 1, "cantidad": 2}   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼ (HTTP Request)
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  BACKEND   â”‚
         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend Procesa:                     â”‚
â”‚ 1. Valida producto existe           â”‚
â”‚ 2. Valida stock disponible          â”‚
â”‚ 3. Crea o actualiza CarritoItem     â”‚
â”‚ 4. Retorna datos del item           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                   â”‚
    â–¼                   â–¼
 âœ… SUCCESS        âŒ ERROR
    â”‚                   â”‚
    â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Fase 2A:     â”‚  â”‚ Fase 2B:         â”‚
â”‚ CONFIRMACIÃ“N â”‚  â”‚ ROLLBACK         â”‚
â”‚              â”‚  â”‚                  â”‚
â”‚ âœ“ Backend OK â”‚  â”‚ â€¢ CachÃ© vuelve   â”‚
â”‚ âœ“ Invalidar  â”‚  â”‚   al estado      â”‚
â”‚   cachÃ©      â”‚  â”‚   anterior       â”‚
â”‚ âœ“ Re-sync UI â”‚  â”‚ â€¢ Mostrar error  â”‚
â”‚              â”‚  â”‚ â€¢ Usuario lo ve  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ Flujo de Prefetch de Datos

```
Usuario pasa mouse sobre Producto
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Evento onMouseEnter detectado         â”‚
â”‚ (en Home, Categories, etc.)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ usePrefetchProductDetail() se ejecuta â”‚
â”‚ o usePrefetchCategoryProducts()       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ React Query Prefetch silencioso       â”‚
â”‚ (No muestra loading, no bloquea UI)   â”‚
â”‚                                       â”‚
â”‚ queryClient.prefetchQuery({           â”‚
â”‚   queryKey: ['product', id],          â”‚
â”‚   queryFn: async () => {              â”‚
â”‚     GET /api/productos/{id}/          â”‚
â”‚   }                                   â”‚
â”‚ })                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Los datos se cargan en background     â”‚
â”‚ Se almacenan en el cachÃ©              â”‚
â”‚ UI NO cambia                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
Usuario hace clic en el producto
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ProductDetail page se abre            â”‚
â”‚ useProductDetail(id) busca en cachÃ©   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Â¡DATOS YA ESTÃN DISPONIBLES!          â”‚
â”‚ âœ¨ Carga INSTANTÃNEA                  â”‚
â”‚ âœ¨ Experiencia de usuario EXCELENTE   â”‚
â”‚ âœ¨ No hay delay                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Estados de Cache de React Query

```
STALE (Datos frescos/vÃ¡lidos)
  â”‚
  â”œâ”€ Mantienen 5 minutos (staleTime)
  â”‚
  â–¼
INACTIVO (No siendo usado)
  â”‚
  â”œâ”€ Se pueden usar del cachÃ©
  â”‚  si siguen siendo "stale"
  â”‚
  â–¼
GARBAGE COLLECTION (10 minutos)
  â”‚
  â””â”€ Se eliminan del cachÃ©
```

## ğŸª Componentes Principales

### Pages

```
Home
â”œâ”€ Listado de productos
â”œâ”€ Prefetch de detalles
â”œâ”€ Usa: useProducts()
â””â”€ Hook: usePrefetchProductDetail()

ProductDetail
â”œâ”€ Detalle de un producto
â”œâ”€ Selector de cantidad
â”œâ”€ BotÃ³n agregar carrito
â”œâ”€ Usa: useProductDetail()
â””â”€ MutaciÃ³n: useAddToCart()

Cart
â”œâ”€ Listado de items del carrito
â”œâ”€ Botones +/- cantidad
â”œâ”€ Botones eliminar
â”œâ”€ Resumen total
â”œâ”€ Usa: useCart()
â””â”€ Mutaciones: useIncreaseQuantity, useDecreaseQuantity, useRemoveFromCart

Categories (NUEVA)
â”œâ”€ Listado de categorÃ­as
â”œâ”€ Prefetch de productos
â”œâ”€ Cards con iconos
â”œâ”€ Usa: useCategories()
â””â”€ Hook: usePrefetchCategoryProducts()

CategoryProducts (NUEVA)
â”œâ”€ Productos de una categorÃ­a
â”œâ”€ Prefetch de detalles
â”œâ”€ Grid similar a Home
â”œâ”€ Usa: useCategoryProducts()
â””â”€ Hook: usePrefetchProductDetail()
```

### Components

```
NavBar
â”œâ”€ Branding (LUDOTECA)
â”œâ”€ Enlace a Inicio
â”œâ”€ Enlace a CategorÃ­as (NUEVO)
â”œâ”€ Badge del carrito
â””â”€ Usa: useCart() para badge

ProductCard
â”œâ”€ Imagen del producto
â”œâ”€ Nombre y precio
â”œâ”€ Stock visual
â”œâ”€ BotÃ³n ver detalle
â””â”€ Respaldado por Product
```

## ğŸ—‚ï¸ Estructura de Datos - Respuestas API

### GET /api/categorias/
```json
[
  {
    "id": 1,
    "nombre": "Estrategia",
    "descripcion": "Juegos de estrategia complejos"
  }
]
```

### GET /api/categorias/1/productos/
```json
[
  {
    "id": 1,
    "nombre": "Catan",
    "descripcion": "...",
    "precio": 89.99,
    "stock": 15,
    "imagen_url": "...",
    "categoria": 1
  }
]
```

### GET /api/carrito/
```json
{
  "items": [
    {
      "id": 1,
      "producto": 1,
      "cantidad": 2,
      "producto_nombre": "Catan",
      "producto_precio": 89.99,
      "producto_imagen": "..."
    }
  ]
}
```

### POST /api/carrito/agregar/
Request:
```json
{
  "producto_id": 1,
  "cantidad": 2
}
```

Response:
```json
{
  "id": 1,
  "producto": 1,
  "cantidad": 2,
  "producto_nombre": "Catan",
  "producto_precio": 89.99,
  "producto_imagen": "..."
}
```

## âœ¨ CaracterÃ­sticas Clave

âœ… **Optimistic Updates**
   - UI se actualiza antes de la respuesta del servidor
   - Mejor UX, sin esperas

âœ… **Rollback AutomÃ¡tico**
   - Si falla la request, el cachÃ© vuelve al estado anterior
   - El usuario lo ve reflejado

âœ… **Prefetch de Datos**
   - Se cargan datos en background
   - Cuando usuario hace clic, datos ya estÃ¡n listos
   - NavegaciÃ³n ultra rÃ¡pida

âœ… **Validaciones Backend**
   - Stock disponible
   - Cantidades vÃ¡lidas
   - Error handling completo

âœ… **CachÃ© Inteligente**
   - 5 minutos de validez
   - Garbage collection en 10 minutos
   - Re-sincronizaciÃ³n automÃ¡tica

